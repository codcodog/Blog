---
title: 微信调用jssdk，签名错误
date: 2016-11-18 16:57:45
tags: 
- Wechat
categories: Phper
---
微信调用jssdk，签名不合法.
==========================
在做微信开发的时候，在页面需要调用微信的jssdk接口。  
按照微信接口文档，把调用的接口js代码放到页面，却发现接口调不起来。  
打开调试模式，发现签名不合法。  

仔细查看一下官方文档，发现：  
> 所有需要使用JS-SDK的页面必须注入配置信息，否则将无法调用（同一个url仅需调用一次，对于变化url的SPA的web app 可在每次url变化时进行调用....）  

> 好吧，不是很理解上面这句话. 不过配置信息里的`signature`生成是需要当前页面的url的，也就是每个页面对应的`signature`是不同的。

而页面配置的那个`signature`是从数据库读取出来的，不是根据当前`url`生成的`signature`，所以导致签名无效.  

微信access_token失效
--------------------
在做微信开发，一般用测试号来进行。  
在获取用户的openid和基本信息的时候，使用了公司服务号的`appid`和`appsecret`.  

然而在开发好的应用，偶尔会出现`access_token`失效的Bug.  
一开始，以为是没判断获取的`access_token`的存活时间。仔细看了代码，发现是有判断的。百思不得其解。  

后来，突然想起来，公司的服务号不仅仅我这边的测试号在用，其他同事也在另外一个项目使用。  
从而导致了这杯具......  

> 服务号刷新了`access_token`,如果再次刷新的话，那么上一个`access_token`会在5分钟后过期.  

所以，在做微信开发的时候，还是按照一个服务号对应一个项目来开发的，毕竟微信开发的坑本来就多了.  
