---
title: 单例模式
date: 2016-11-21 09:51:30
tags:
- 设计模式
categories: Phper
---

什么是单例模式
==============
> 作为对象的创建模式，单例模式确保某一个类只有一个实例，而且自行实例化并向整个系统全局地提供这个实例。它不会创建实例副本，而是会向单例类内部存储的实例返回一个引用。  

要点：  
- 某个类只能有一个实例。  
- 它必须自行创建这个实例。  
- 它必须自行向整个系统提供这个实例。  

**注意：**  
> PHP的单例模式是相对而言的，因为PHP的解释运行机制使得每个PHP页面被解释执行后，所有的相关资源都会被回收。  
>
> 也就是说，PHP在语言级别上没有办法让某个对象常驻内存。在PHP中，所有的变量都是在页面级的，无论是全局变量，还是类的静态成员，都会在页面执行完毕后被清空，结果会重新建立新的对象，这样也就失去了单例的意义。  
>
> 不过，在实际应用中同一个页面可能会存在多个业务逻辑，这时单例模式就起到了很重要的作用，有效地避免了重复new对象，（new对象会消耗内存资源）。  

应用场合
=======
- 应用程序与数据库交互  

> 一个应用中会存在大量的数据库操作， 比如通过数据库句柄来连接数据库这一行为，使用单例模式可以避免大量的new操作，因为每一次new操作都会消耗内存资源和系统资源。  

- 控制配置信息  

> 如果系统中需要有一个类来全局控制某些配置信息，那么使用单例模式可以很方便的实现。  

单例模式的实现
==============
```
class Demo
{
    private static $_instance = null;

    private function __construct()
    {
    }

    private function __clone()
    {
    }

    public static function getInstance()
    {
        if (! (self::$_instance instanceof self)) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }
}

$demo = Demo::getInstance();
```
PHP单例模式实现的核心：  
- 需要一个保存类的唯一实例的静态成员变量（同常$_instance私有静态变量）  
- 构造函数和克隆函数必须声明为私有的，防止外部程序new类从而失去单例模式的意义。  
- 必须提供一个访问这个实例的公共的静态方法，从而返回唯一实例的一个引用。  
